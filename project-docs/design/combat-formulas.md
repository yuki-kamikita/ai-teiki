## 戦闘計算式（開発者・AI向け）

### 目的
シンプルで調整しやすい計算式を用意し、後から係数を変えられるようにする。

### 記号
- ATK: 筋力
- INT: 知識
- HP: 体力
- MP: 魔力
- MND: 精神
- SPD: 速度
- SKL: スキルの威力係数（例: 1.0〜2.0）

### 物理ダメージ
基本ダメージ:
- base = ATK * SKL
- rand = 0.75〜1.00 の乱数
最終:
- damage = floor(base * rand * (1 - phys_guard))

人間向けの表記:
- 物理ダメージ = 基礎ダメージ × 乱数 × (1 - 防御率)
- 基礎ダメージ = 筋力 × 技の強さ
- 防御率 = 0.05〜0.65の範囲に収まるように調整する
- 防御率は「筋力 / (筋力 + 200)」を基準にする

物理防御率（phys_guard）:
- phys_guard = clamp(0.05, 0.65, DEF / (DEF + 200))
- DEF は「筋力から算出」する場合は DEF = ATK とする
  - 例: 筋力100 → phys_guard ≒ 0.33

### 魔法ダメージ
基本ダメージ:
- base = SKL
- rand = 0.75〜1.00 の乱数
最終:
- damage = floor(base * rand)

魔法の特徴:
- 知識（INT）や精神（MND）はダメージに影響しない
- 防御側のステータスでダメージ減少しない

人間向けの表記:
- 魔法ダメージ = 基礎ダメージ × 乱数
- 基礎ダメージ = 技の強さ

### 魔法のコスト
魔法は技ごとに消費魔力（MP）を持つ。
- 強い技ほどMP消費が大きい
- MPが足りない場合は発動できない

### クリティカル（Cri）
基本クリ率:
- crit_rate = clamp(0.05, 0.50, (INT / 500))
適用:
- 乱数で判定し、成功時は「防御率を0として」ダメージ計算する

人間向けの表記:
- クリティカル発生時のダメージ = 基礎ダメージ × 乱数 × (1 - 0)
- クリティカル発生率は「知識 / 500」を基準にする
- ただし最小5%、最大50%の範囲に収める

### 命中・回避（単体攻撃のみ）
命中率:
- hit_rate = clamp(0.30, 0.98, 0.75 + (SPD_attacker - SPD_defender) / 1000)
回避:
- 回避成功時はダメージ0

人間向けの表記:
- 命中率 = 基本命中 + (攻撃側速度 - 防御側速度) / 1000
- ただし最小30%、最大98%の範囲に収める

### 精神（MND）の影響
- MND = 0 の場合:
  - 行動不能
  - 受けるダメージは必ずクリティカル
- MNDは「乱数の最低値」「発動成功率の最大値」「異常防御率」に影響
  - 乱数の最低値: rand_min = 0.65 + (MND / 1000)（上限1.00）
  - 発動成功率の最大値: cap = 0.65 + (MND / 500)（上限0.99）
  - 異常防御率: status_resist = clamp(0.00, 0.50, MND / 400)

人間向けの表記:
- 精神が0: 行動不能 + 被ダメージが必ずクリティカル
- 乱数の最低値 = 0.65 + (精神 / 1000)（上限1.00）
- 発動成功率の最大値 = 0.65 + (精神 / 500)（上限0.99）
- 異常防御率 = 精神 / 400 を基準にする
- ただし最小0%、最大50%の範囲に収める

### 状態異常付与
付与成功率:
- base_rate（スキル固有）に status_resist を差し引く
- success = clamp(0.05, cap, base_rate - status_resist)

人間向けの表記:
- 状態異常成功率 = 技の成功率 - 相手の耐性
- ただし最小5%、最大は「精神で決まる上限」の範囲に収める

### 魔力（MP）の回復
毎ターン回復:
- mp_regen = floor(MP * 0.10)

人間向けの表記:
- 毎ターン回復MP = 最大MP × 10%

### 調整ポイント
- SKL（威力係数）
- 防御率の分母（200）
 - 乱数の範囲（0.75〜1.00）
- クリ倍率（1.5）
- 命中率の上下限
